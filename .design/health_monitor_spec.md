# Health Monitor 设计文档

## 功能概述
全面的自我诊断系统，定期检查 JANUS 的健康状况并生成报告。

## 诊断维度

### 1. 基因健康 (Gene Health)
- 扫描所有动态技能文件
- 检查 `.json` 和 `.py` 文件是否配对
- 检测"孤儿文件"（只有清单没有代码，或反之）
- 统计技能总数和分类

### 2. 记忆健康 (Memory Health)
- **Mirror Logs**: 
  - 统计日志文件数量
  - 计算总大小
  - 检查是否有超大日志（>1MB）
  - 建议归档阈值
  
- **Knowledge Store**:
  - 统计各层级事实数量
  - 检查是否有重复事实
  - 计算知识库大小

### 3. 系统资源 (System Resources)
- 磁盘空间检查
- 工作目录大小统计
- 检测大文件（>10MB）

### 4. 感知系统 (Perception System)
- 统计活跃的反射规则数量
- 检查规则冲突（相同 pattern 的多个规则）
- 统计最近的感知事件数量

### 5. 性能指标 (Performance Metrics)
- 技能调用频率统计（从日志中提取）
- 识别"僵尸技能"（从未被调用）
- 识别"热门技能"（高频调用）

## 输出格式

### 健康评分系统
- **优秀** (90-100分): 🟢 系统状态良好
- **良好** (70-89分): 🟡 有轻微问题，建议关注
- **警告** (50-69分): 🟠 存在明显问题，需要处理
- **危险** (<50分): 🔴 系统健康堪忧，立即处理

### 报告结构
```
🏥 JANUS 健康检查报告
生成时间: 2026-01-02 23:55
总体评分: 85/100 🟡

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📊 详细诊断结果:

1. 基因健康 [90/100] 🟢
   ✅ 发现 14 个动态技能
   ✅ 所有技能文件完整配对
   ⚠️  发现 2 个从未被调用的技能: security_gen, weather_expert

2. 记忆健康 [75/100] 🟡
   ✅ Mirror 日志: 5 个文件 (2.3 MB)
   ⚠️  知识库大小: 156 KB (建议定期清理 episodic 层)
   ✅ 各层级分布合理

3. 系统资源 [95/100] 🟢
   ✅ 磁盘剩余: 45.2 GB
   ✅ 工作目录: 12.5 MB
   ✅ 无异常大文件

4. 感知系统 [80/100] 🟢
   ✅ 活跃反射规则: 5 条
   ⚠️  检测到 1 条规则冲突 (json_sync vs code_refactor_js)
   ✅ 最近感知事件: 10 条

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

💡 优化建议:

1. [高优先级] 清理或归档 episodic 层的旧事实
2. [中优先级] 考虑移除僵尸技能: security_gen, weather_expert
3. [低优先级] 解决感知规则冲突

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

## 参数

- `mode`: 
  - `quick` (默认): 快速检查，只检查关键指标
  - `full`: 全面检查，包括性能分析
  - `auto`: 自动模式，检查后自动执行低风险优化

- `output`:
  - `report` (默认): 生成文本报告
  - `json`: 输出 JSON 格式（便于程序化处理）

## 实现要点

1. 所有文件操作使用相对路径
2. 异常处理要完善（避免诊断过程中崩溃）
3. 评分算法要合理（不同维度权重不同）
4. 建议要可执行（提供具体的技能调用命令）
